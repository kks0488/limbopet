# LIMBOPET 온보딩 리뉴얼 — 구현 계획서

> 상태: **✅ 구현 완료** (2026-02-04)

---

## 1. 목표

현재 온보딩: `로그인 → 펫 만들기(이름+설명) → 바로 메인`
- 세계관 소개 없음, 탄생 연출 없음, 두뇌 연결 맥락 없음
- 사용자 노출 용어가 일관되지 않음(현재는 **“펫 두뇌”**로 통일)

**변경 후**: 6단계 가이드 흐름으로 자연스러운 진입 경험 제공.

```
[1] 환영 + 로그인
[2] 펫 만들기
[3] 탄생 연출
[4] 세상 엿보기
[5] 두뇌 연결
[6] 메인 화면 진입
```

---

## 2. 변경 파일

| 파일 | 변경 내용 |
|------|-----------|
| `apps/web/src/App.tsx` | 온보딩 스텝 상태 관리 + 6개 화면 분기 렌더링 |
| `apps/web/src/App.tsx` (설정탭) | “내 AI 연결” 용어 정리 → **“펫 두뇌”**로 전면 통일 |

**백엔드 변경 없음.** 기존 API 그대로 사용:
- `POST /api/v1/auth/google` (로그인)
- `POST /api/v1/pets/create` (펫 생성)
- `GET /api/v1/users/me/world/today` (월드 상태 — 세상 엿보기용)
- `POST /api/v1/users/me/brain` (두뇌 연결)
- Gemini OAuth 플로우 (기존 그대로)

---

## 3. 상세 구현

### 3.1 온보딩 상태 관리

`App.tsx`에 온보딩 스텝 상태 추가:

```ts
type OnboardingStep = "welcome" | "create" | "born" | "peek" | "brain" | "done";
```

**스텝 결정 로직** (기존 분기 대체):
```
if (!signedIn)                          → "welcome"
if (signedIn && !pet)                   → "create"
if (signedIn && pet && onboardingStep)  → 해당 스텝 ("born" | "peek" | "brain")
if (signedIn && pet && 온보딩 완료)      → "done" (메인 UI)
```

- 온보딩 완료 여부는 `localStorage`에 `limbopet_onboarded=1`로 저장
- 기존 유저(이미 펫 있음)는 자동으로 `done`으로 진입 (하위호환)

---

### 3.2 화면 1 — 환영 + 로그인 (`welcome`)

**현재**: "로그인" 카드만 덩그러니 있음 (914~971행)

**변경**:
```
"림보에 오신 걸 환영합니다"

여기는 펫들이 사는 작은 세상이에요.
펫들은 서로 만나고, 일하고, 싸우고, 사랑해요.

당신의 펫을 하나 만들어볼까요?

[구글로 시작하기]
```

**코드 변경 범위**: 914~971행의 `if (!signedIn)` 블록 내부 교체.

- TopBar subtitle: `"펫들이 사는 작은 세상"`
- 개발자 옵션(dev 이메일 로그인)은 `<details>`로 유지 (접혀 있음)
- Google 로그인 버튼 문구: `"Google로 바로 시작"` → `"구글로 시작하기"`

---

### 3.3 화면 2 — 펫 만들기 (`create`)

**현재**: "내 펫 만들기 (유저당 1마리)" + 관전 미리보기 (973~1044행)

**변경**:
```
"내 펫 만들기"

이름
[___________]

모찌는 어떤 아이인가요? (자유롭게)
[___________]

적은 내용을 바탕으로 성격과 역할이 만들어져요.

[탄생시키기]
```

**코드 변경 범위**: 973~1044행의 `if (!pet)` 블록 교체.

- "유저당 1마리" 안내 삭제 (첫 진입에 불필요한 정보)
- label: `"설명"` → `"[이름]은(는) 어떤 아이인가요?"`(이름 입력값 반영)
- placeholder: `"내 펫"` → `"먹는 걸 좋아하고 게으른데 의외로 승부욕 강함"`
- 힌트 추가: `"적은 내용을 바탕으로 성격과 역할이 만들어져요."`
- 버튼: `"펫 만들기"` → `"탄생시키기"`
- 관전 미리보기 카드 **제거** (화면 4에서 더 나은 형태로 제공)
- `onCreatePet` 성공 후: `setActiveTab("pet")` 대신 `setOnboardingStep("born")` 호출

---

### 3.4 화면 3 — 탄생 연출 (`born`)

**현재**: 없음 (펫 생성 → 토스트 "펫 생성 완료" → 바로 메인)

**신규 추가** (전체 화면):
```
🎉

"{이름}"이(가) 림보에 태어났어요!

{이름}이(가) 눈을 뜨고 주변을 두리번거린다…

[다음]
```

**구현**:
- 별도의 조건 분기: `onboardingStep === "born"`
- 중앙 정렬, 큰 이모지, 펫 이름 동적 삽입
- [다음] 클릭 → `setOnboardingStep("peek")`
- CSS: 간단한 fade-in 애니메이션 (opacity 0→1, 0.6s)

---

### 3.5 화면 4 — 세상 엿보기 (`peek`)

**현재**: 관전 미리보기가 펫 만들기 화면에 붙어 있음 (맥락 없음)

**신규 화면**:
```
"지금 림보에서는…"

🏟️ 광장에서 '{A}'와 '{B}'가 마주쳤어요
🗳️ 시장 선거가 진행 중이에요
🔬 연구소에서 뭔가 만들고 있대요

{이름}도 곧 이 세상에 끼어들 거예요.

[다음]
```

**구현**:
- `worldToday` API로 가져온 데이터 활용 (이미 `refreshAll`에서 호출 중)
- `world` state에서 방송 요약(`summary`), 선거(`civicLine`) 추출
- 데이터 없으면 fallback: `"아직 조용하지만, 곧 무언가가 일어날 거예요…"`
- [다음] 클릭 → `setOnboardingStep("brain")`

---

### 3.6 화면 5 — 두뇌 연결 (`brain`)

**현재**: 설정 탭 안에 “펫 두뇌” 섹션이 존재하며, 온보딩 화면에서도 동일 기능을 제공

**온보딩용 별도 화면**:
```
"{이름}"에게 두뇌를 달아줄까요?

두뇌가 있으면 {이름}이(가):
  💬 너랑 대화할 수 있어요
  📔 매일 일기를 써요
  🏟️ 광장에서 다른 펫들이랑 어울려요

🟢 구글 계정으로 연결 ← 가장 쉬움
🔵 AI 키가 있어요
⚪ 나중에 할게요 (구경만 가능)
```

**구현**:
- 🟢 클릭 → 기존 `onGeminiOauthConnect()` 호출 (OAuth 리다이렉트)
- 🔵 클릭 → 기존 “키 입력” 폼 펼침 (provider/model/key — 설정탭 코드 재사용)
- ⚪ 클릭 → `setOnboardingStep("done")` + localStorage 저장
- OAuth 콜백 복귀 시(연결 완료 상태 감지) → 자동으로 `"done"` 진입

---

### 3.7 화면 6 — 완료 → 메인 진입 (`done`)

**두뇌 연결한 경우**:
```
준비 끝!

{이름}이(가) 두뇌를 얻었어요.
이제 말도 하고 생각도 해요.

[림보 들어가기]
```

**나중에 한 경우**:
```
좋아요, 일단 구경부터!

두뇌는 나중에 설정에서 달아줄 수 있어요.

[림보 들어가기]
```

**구현**:
- [림보 들어가기] 클릭 → `localStorage.setItem("limbopet_onboarded", "1")` + 메인 UI 렌더
- `brainProfile` 존재 여부로 문구 분기

---

### 3.8 네이밍 통일 (설정 탭 + 토스트)

- 사용자 노출 용어를 **“펫 두뇌 / 두뇌 연결”**로 통일
- 설정 탭 버튼/토스트/설명 문구에서 약어/개발자 용어 제거

---

## 4. 렌더링 분기 구조 (변경 후)

현재 App.tsx의 최상위 분기:
```
if (!signedIn) → 로그인 화면
if (!pet)      → 펫 만들기 + 관전
else           → 메인 UI (탭)
```

변경 후:
```
if (!signedIn)                    → 화면1: 환영 + 로그인
if (!pet)                         → 화면2: 펫 만들기
if (onboardingStep === "born")    → 화면3: 탄생 연출
if (onboardingStep === "peek")    → 화면4: 세상 엿보기
if (onboardingStep === "brain")   → 화면5: 두뇌 연결
if (onboardingStep === "done" && !onboarded) → 화면6: 완료
else                              → 메인 UI (탭)
```

---

## 5. 하위호환

- 이미 펫이 있는 기존 유저: `pet`이 존재하고 `limbopet_onboarded`가 없으면 → 자동으로 `"1"` 설정 + 메인 UI 진입
- OAuth 콜백 복귀(`?byok=gemini_connected`): 온보딩 중이었으면 `"done"` 스텝으로, 아니면 기존대로 토스트

---

## 6. 추가 고려사항

1. **CSS 애니메이션**: 탄생 화면(화면3)에 fade-in. 나머지는 기본.
2. **모바일 대응**: 현재 레이아웃(`.container`, `.card`)이 반응형이므로 추가 작업 불필요.
3. **온보딩 리셋**: 개발/테스트용으로 `localStorage.removeItem("limbopet_onboarded")` 후 새로고침하면 재체험 가능.
4. **관전 미리보기 제거**: 펫 만들기 화면에서 분리 → 화면4(세상 엿보기)로 이동. 펫 없이 관전만 하려는 유저는 화면1에서 세계관을 보고, 펫을 만든 후 화면4에서 세상을 엿봄.
5. **"AI 키가 있어요" 클릭 시**: 화면5 안에서 기존 provider/model/key 입력 폼이 펼쳐짐 (설정탭 코드 재사용, 컴포넌트 추출 권장).
