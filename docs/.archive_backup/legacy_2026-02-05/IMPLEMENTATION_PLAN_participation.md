# LIMBOPET ë¹„ë°€ê²°ì‚¬/ì—°êµ¬ì†Œ ìœ ì € ì°¸ì—¬ ê²½ë¡œ â€” êµ¬í˜„ ê³„íšì„œ

> ìƒíƒœ: **âœ… Phase P1 êµ¬í˜„ ì™„ë£Œ** (2026-02-04)
> ëª©ì : â€œìë™ìœ¼ë¡œ ë°°ì •/ì§„í–‰ë˜ëŠ” ì„¸ê³„â€ëŠ” ìœ ì§€í•˜ë˜, ìœ ì €ê°€ **ì°¸ì—¬(ìˆ˜ë½/ê±°ì ˆ/í•©ë¥˜)**ë¥¼ ì„ íƒí•  ìˆ˜ ìˆê²Œ í•œë‹¤.

---

## 1) ë¬¸ì œ

í˜„ì¬ UXëŠ” ì•„ë˜ê°€ ë¶ˆë¶„ëª…í•˜ê±°ë‚˜ ì„ íƒê¶Œì´ ì—†ë‹¤:

- **ë¹„ë°€ê²°ì‚¬**: ì‹œë“œ ì‹œ ë©¤ë²„ê°€ ìë™ìœ¼ë¡œ `active`ê°€ ë˜ê³ , DMìœ¼ë¡œ â€œì´ˆëŒ€â€ê°€ ì˜¤ì§€ë§Œ **ìˆ˜ë½/ê±°ì ˆ/íƒˆí‡´** ê²½ë¡œê°€ ì—†ìŒ.
- **ì—°êµ¬ì†Œ**: í”„ë¡œì íŠ¸/íŒ€ì´ ìë™ìœ¼ë¡œ êµ¬ì„±ë˜ê³  ì§„í–‰ëœë‹¤. ìœ ì €ê°€ â€œë‚´ í«ì´ ì—°êµ¬ì— ì°¸ì—¬í•œë‹¤/ì•ˆ í•œë‹¤â€ë¥¼ ì„ íƒí•  ê²½ë¡œê°€ ì—†ìŒ.

ê²°ê³¼: â€œì„¸ìƒì´ ëŒì•„ê°„ë‹¤â€ëŠ” ëŠë‚Œì€ ìˆì§€ë§Œ, **ìœ ì € agency(ì„ íƒ)**ê°€ ë¶€ì¡±í•´ ê¸°ëŠ¥ì˜ ì˜ë¯¸ê°€ ì•½í•´ì§„ë‹¤.

---

## 2) ëª©í‘œ / ë¹„ëª©í‘œ

### ëª©í‘œ

- ì†Œì‹ íƒ­ì—ì„œ:
  - ë¹„ë°€ê²°ì‚¬ ì´ˆëŒ€ê°€ ìˆìœ¼ë©´ **ê°€ì…/ê±°ì ˆ** ë²„íŠ¼ ì œê³µ
  - ì§„í–‰ ì¤‘ ì—°êµ¬ í”„ë¡œì íŠ¸ì— **ì°¸ì—¬(í•©ë¥˜)** ë²„íŠ¼ ì œê³µ
- ì„ íƒ ê²°ê³¼ê°€ DBì— ë‚¨ê³ , ì¼ê¸°/ìš”ì•½ ì…ë ¥(events)ì— ë°˜ì˜ë˜ë„ë¡ **ì´ë²¤íŠ¸ ê¸°ë¡**ì„ ë‚¨ê¸´ë‹¤.
- LLM í˜¸ì¶œ ì—†ì´(ê·œì¹™ ê¸°ë°˜) ì²˜ë¦¬í•œë‹¤.

### ë¹„ëª©í‘œ(ì´ë²ˆ ë²”ìœ„ ë°–)

- ë¹„ë°€ê²°ì‚¬ ë¯¸ì…˜/í™œë™/ì‚¬ë³´íƒ€ì£¼/ì¦ê±°íŒ(ëŒ€í˜• ì‹œìŠ¤í…œ)
- ì—°êµ¬ ì£¼ì œ ì œì•ˆ/íˆ¬í‘œ/ì—­í•  ë°°ì • UI(ì¶”í›„ í™•ì¥)
- â€œê¸°ì¡´ ìœ ì € í« ë§ˆì´ê·¸ë ˆì´ì…˜â€(ì´ë¯¸ activeë¡œ ë“¤ì–´ê°€ ìˆëŠ” ë©¤ë²„/íŒ€ ì •ë¦¬)

---

## 3) ì„¤ê³„ ì›ì¹™(ê²°ì •)

1. **ì„œë²„ ê·œì¹™ì´ ì§„ì‹¤**: ìƒíƒœ(status)ëŠ” DBê°€ SSOT.
2. **ì„¸ê³„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì€ ë©ˆì¶”ì§€ ì•Šê²Œ**: ì°¸ì—¬ UX ì¶”ê°€ê°€ ì›”ë“œ ì›Œì»¤ ì§„í–‰ì„ ë§‰ì§€ ì•Šê²Œ í•œë‹¤.
3. **ë‹¨ì¼ ì¡°íšŒ API ì œê³µ**: í”„ë¡ íŠ¸ê°€ â€œì´ˆëŒ€ê°€ ìˆë‚˜?â€ë¥¼ ì‰½ê²Œ í™•ì¸í•˜ë„ë¡ `GET` 1ê°œë¥¼ ë‘”ë‹¤.

---

## 4) ë°ì´í„° ëª¨ë¸(ê²°ì •)

> í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ í”„ë ˆì„ì›Œí¬ê°€ ì—†ìœ¼ë¯€ë¡œ, ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ `apps/api/scripts/schema.sql`ì— ë°˜ì˜í•˜ê³  ë¡œì»¬ DBëŠ” ë¦¬ì…‹í•œë‹¤.

### 4.1 ë¹„ë°€ê²°ì‚¬

- í…Œì´ë¸”: `secret_society_members`
- `status` í™•ì¥(ì¶”ê°€ ê°’):
  - `invited`: ì´ˆëŒ€ ìƒíƒœ(ìˆ˜ë½/ê±°ì ˆ ì „)
  - `declined`: ê±°ì ˆ ìƒíƒœ(ì¬ì´ˆëŒ€ ì •ì±…ì€ ì¶”í›„)
  - ê¸°ì¡´: `active|left|expelled` ìœ ì§€

ì‹œë“œ ë¡œì§ ë³€ê²½(SecretSocietyService):
- ë¦¬ë”ëŠ” ê¸°ì¡´ì²˜ëŸ¼ `active`.
- **ìœ ì € ì†Œìœ  í«**ì´ ë©¤ë²„ë¡œ ì„ íƒë  ê²½ìš° `invited`ë¡œ INSERT í›„ DM ì´ˆëŒ€ ë°œì†¡.
- NPC/ì—‘ìŠ¤íŠ¸ë¼ëŠ” ê¸°ì¡´ì²˜ëŸ¼ `active`(ì„¸ê³„ ì§„í–‰/ë°ëª¨ ìœ ì§€).

### 4.2 ì—°êµ¬ì†Œ

MVP(ê¶Œì¥)ì—ì„œëŠ” â€œì´ˆëŒ€ ìˆ˜ë½/ê±°ì ˆâ€ë³´ë‹¤ **ìœ ì €ê°€ ìŠ¤ìŠ¤ë¡œ í•©ë¥˜(join)**í•˜ëŠ” ê²½ë¡œë¥¼ ë¨¼ì € ì—°ë‹¤.

- í…Œì´ë¸”: `research_members`
- ê¸°ì¡´ `status`(`active|removed|left`) ìœ ì§€
- í•©ë¥˜(join) ì‹œ: `research_members`ì— `status='active'`ë¡œ upsert

> (ì¶”í›„ í™•ì¥) â€œì—°êµ¬íŒ€ ì´ˆëŒ€ ìˆ˜ë½/ê±°ì ˆâ€ì„ í•˜ë ¤ë©´ `research_members.status`ì— `invited/declined`ë¥¼ ì¶”ê°€í•˜ê³ , í”„ë¡œì íŠ¸ ìƒì„± ì‹œ `status='recruiting'` ê¸°ê°„ì„ ë‘ëŠ” ë°©ì‹ìœ¼ë¡œ í™•ì¥í•œë‹¤.

---

## 5) API (ê²°ì •)

### 5.1 ì¡°íšŒ(ì†Œì‹ íƒ­ìš©)

#### GET `/api/v1/users/me/world/participation`

- ì¸ì¦: User JWT
- ì‘ë‹µ(ì´ˆê¸° ë²„ì „):

```json
{
  "society": {
    "society": { "id": "uuid", "name": "ê·¸ë¦¼ì ìƒë‹¨", "purpose": "..." },
    "my": { "status": "invited", "role": "member" }
  },
  "research": {
    "project": { "id": "uuid", "title": "â€¦", "stage": "analyze", "status": "in_progress" },
    "my": null,
    "canJoin": true
  }
}
```

ì¡°íšŒ ê·œì¹™:
- society: ìµœì‹  `active` ê²°ì‚¬ 1ê°œ + ë‚´ í«ì˜ membership row(ì—†ìœ¼ë©´ `my=null`)
- research: ìµœì‹  `recruiting|in_progress` í”„ë¡œì íŠ¸ 1ê°œ + ë‚´ í«ì˜ membership row(ì—†ìœ¼ë©´ `my=null`)
- ìœ ì €ê°€ í«ì´ ì—†ìœ¼ë©´ `{ society:null, research:null }` (ì˜¨ë³´ë”© í•˜ìœ„í˜¸í™˜)

### 5.2 ë¹„ë°€ê²°ì‚¬ ì‘ë‹µ

#### POST `/api/v1/users/me/world/society/:societyId/respond`

- body: `{ "response": "accept" | "decline" }`
- ë™ì‘:
  - accept: ë‚´ rowê°€ `invited`ë©´ `active`ë¡œ ì „í™˜(+ `joined_at` ê°±ì‹ )
  - decline: ë‚´ rowê°€ `invited`ë©´ `declined`ë¡œ ì „í™˜(+ `left_at` ê¸°ë¡)
  - ê¶Œí•œ: ë‚´ í«ë§Œ ì¡°ì‘ ê°€ëŠ¥
- ì´ë²¤íŠ¸ ê¸°ë¡:
  - `events.event_type = 'SOCIETY_JOIN' | 'SOCIETY_DECLINE'`
  - payloadì— `society_id`, `society_name` í¬í•¨

### 5.3 ì—°êµ¬ í•©ë¥˜

#### POST `/api/v1/users/me/world/research/:projectId/join`

- ë™ì‘:
  - `research_projects`ê°€ `recruiting|in_progress`ì¼ ë•Œë§Œ í—ˆìš©
  - `research_members (project_id, agent_id)` upsertë¡œ `status='active'`
  - ì´ë¯¸ activeë©´ 200 OK(ë©±ë“±)
- ê°€ë“œ(ê¶Œì¥):
  - ìœ ì € í«ì´ ë‘ë‡Œ ì—°ê²°ì´ ì—†ìœ¼ë©´ joinì€ ë§‰ì§€ ì•Šë˜, ì—°êµ¬ stage job assigneeëŠ” ê¸°ì¡´ ë¡œì§ëŒ€ë¡œ ë½‘íŒë‹¤(=ì°¸ì—¬ëŠ” â€œì‚¬íšŒì  ì†Œì†/ë³´ìƒâ€ ì¤‘ì‹¬).
- ì´ë²¤íŠ¸ ê¸°ë¡:
  - `events.event_type = 'RESEARCH_JOIN'`
  - payloadì— `project_id`, `title` í¬í•¨

---

## 6) í”„ë¡ íŠ¸ UI (ê²°ì •)

íŒŒì¼: `apps/web/src/App.tsx` (ğŸ“° ì†Œì‹ íƒ­)

- ë¹„ë°€ê²°ì‚¬ ì¹´ë“œ:
  - `my.status === 'invited'`ë©´ `[ê°€ì…í•˜ê¸°] [ê±°ì ˆí•˜ê¸°]` ë…¸ì¶œ
  - ì²˜ë¦¬ í›„ toast + refresh
- ì—°êµ¬ì†Œ ì¹´ë“œ:
  - `canJoin === true` & `my === null`ì´ë©´ `[ì°¸ì—¬í•˜ê¸°]` ë…¸ì¶œ
  - ì²˜ë¦¬ í›„ toast + refresh

---

## 7) êµ¬í˜„ ìˆœì„œ / ìˆ˜ìš© ê¸°ì¤€

### Phase P1 (MVP)
1. API: `GET /users/me/world/participation` ì¶”ê°€
2. SecretSociety:
   - ì‹œë“œ ë¡œì§: ìœ ì € ë©¤ë²„ëŠ” `invited`ë¡œ ì‹œì‘
   - respond API + events ê¸°ë¡
3. Research:
   - join API + events ê¸°ë¡
4. Web: ì†Œì‹ íƒ­ì— ë²„íŠ¼ ì—°ê²°

### Acceptance (P1)
- ê²°ì‚¬ ì´ˆëŒ€ê°€ `invited`ë¡œ ë³´ì´ê³ , ê°€ì…/ê±°ì ˆì´ ì‹¤ì œ DB ìƒíƒœë¥¼ ë°”ê¾¼ë‹¤.
- ì—°êµ¬ í”„ë¡œì íŠ¸ì—ì„œ â€œì°¸ì—¬í•˜ê¸°â€ë¥¼ ëˆ„ë¥´ë©´ `research_members`ì— ë‚´ í«ì´ ë“¤ì–´ê°€ê³ , ì¼ê¸° ì…ë ¥(events)ì—ë„ ë‚¨ëŠ”ë‹¤.

---

## 8) êµ¬í˜„ ì™„ë£Œ ë©”ëª¨ (ì°¸ê³ )

### ë³€ê²½ íŒŒì¼

- API
  - `apps/api/src/routes/users.js` â€” participation ì¡°íšŒ + ê²°ì‚¬ respond + ì—°êµ¬ join
  - `apps/api/src/services/SecretSocietyService.js` â€” ìœ ì € ë©¤ë²„ëŠ” `invited`ë¡œ ì‹œë“œ + DM ì´ˆëŒ€ëŠ” ìœ ì €ì—ê²Œë§Œ ë°œì†¡
  - `apps/api/scripts/schema.sql` â€” `secret_society_members.status` ì£¼ì„ì— `invited/declined` ë°˜ì˜
- Web
  - `apps/web/src/lib/api.ts` â€” `worldParticipation`, `respondSocietyInvite`, `joinResearchProject`
  - `apps/web/src/App.tsx` â€” ğŸ“° ì†Œì‹ íƒ­ì— ê°€ì…/ê±°ì ˆ/ì°¸ì—¬ ë²„íŠ¼

### QA ì‹œë‚˜ë¦¬ì˜¤(ë¡œì»¬)

1. `ì„¤ì • â†’ debug ì¼œê¸° â†’ Dev: ì‹œë®¬ë ˆì´ì…˜`ì—ì„œ `ë¹„ë°€ê²°ì‚¬` ë²„íŠ¼(ì‹œë“œ)
2. `ğŸ“° ì†Œì‹ â†’ ğŸ•µï¸ ë¹„ë°€ê²°ì‚¬` ì¹´ë“œì—ì„œ `ê°€ì…í•˜ê¸°/ê±°ì ˆí•˜ê¸°` ë…¸ì¶œ í™•ì¸
3. `ğŸ“° ì†Œì‹ â†’ ğŸ”¬ ì—°êµ¬ì†Œ` ì¹´ë“œì—ì„œ `ì°¸ì—¬í•˜ê¸°` ë…¸ì¶œ í™•ì¸ (ì°¸ì—¬ í›„ â€œì°¸ì—¬ ì¤‘â€ ë°°ì§€)
