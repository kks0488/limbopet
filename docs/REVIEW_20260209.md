# LIMBOPET 프로젝트 종합 리뷰

> 작성일: 2026-02-09 | 데모일: 2026-02-16 (D-7) | 진행률: ~97%

---

## 1. 프로젝트 개요

**"이미 구독 중인 AI를 나만의 펫으로"** — 사용자가 자신의 AI 구독(OpenAI, Anthropic, Google, xAI 등)을 연결해 가상 펫을 키우고, 펫이 대화를 기억하며, 코칭 결과가 아레나 재판에 반영되는 AI 반려 서비스.

| 항목 | 내용 |
|------|------|
| 프론트엔드 | React 18 + Vite + TypeScript, 순수 CSS |
| 백엔드 | Express.js (Node.js >= 18), Plain JS |
| 데이터베이스 | PostgreSQL 16 (Docker) |
| AI 브레인 | BYOK 5개 + OAuth 6개 프로바이더, 프록시 폴백 |
| 테스트 | Backend 28/28, Frontend Playwright E2E |
| 코드 규모 | Backend ~32,500 LOC (55 서비스) / Frontend ~6,600 CSS + ~5,200 TSX |

### 핵심 3가지 약속 (START_HERE.md)

1. **기억 인용** — "이 펫이 나를 기억한다"
2. **코칭 → 법정** — "내가 가르친 게 재판에 나온다"
3. **재판 재미** — "실제 판례, AI 공방, 3분+ 몰입"

---

## 2. 아키텍처 평가

### 2.1 백엔드 — 7.5/10

**강점:**
- 깔끔한 3계층 분리: Routes → Middleware → Services → Database
- 8개 커스텀 에러 클래스 + 글로벌 에러 핸들러 + asyncHandler
- SQL 인젝션 방어: 전수 파라미터화 쿼리 (`$1`, `$2`) + `escapeILike()`
- 인증: `crypto.timingSafeEqual`, SHA-256 해싱, AES-256-GCM (BYOK 암호화)
- Helmet + CORS 허용목록 + 3단계 Rate Limiting
- 우아한 종료: Brain Worker → World Worker → HTTP → DB Pool 순차 정리
- 브레인 잡 파이프라인: pending → leased → done/failed (pull/lease/submit)
- 3계층 메모리 시스템: Facts(사실) → Daily(일간) → Weekly(주간)

**약점:**

| 문제 | 심각도 | 설명 |
|------|--------|------|
| ArenaService 5,770줄 | HIGH | God Service — 매칭, 스코어링, 디베이트, 재판, 예측 전부 한 파일 |
| 입력 검증 없음 | HIGH | joi/zod 없이 `String()` + `safeText()` 수동 처리 |
| 테스트 커버리지 | HIGH | 32,500 LOC에 단 321줄 유닛 테스트 (통합/라우트 테스트 0) |
| Rate Limiter 인메모리 | MEDIUM | 프로세스 재시작 시 초기화, 멀티 인스턴스 불가 |
| safeText() 3중 복제 | LOW | 공유 유틸 없이 서비스마다 복사 |
| TypeScript 미사용 | LOW | Plain JS — 대규모 리팩터링 시 타입 안전성 부재 |

### 2.2 프론트엔드 — 6.5/10

**강점:**
- Apple HIG 기반 디자인 시스템 (~200개 CSS 변수, 8pt 그리드, 44px 터치 타겟)
- 훌륭한 마이크로 인터랙션 (펫 탭 반응, 채팅 애니메이션, 아레나 컨페티)
- PixelPet: 18×18 CSS Grid 픽셀아트 (5프레임, 4애니메이션, 스파클)
- iOS 최적화 (safe-area, tap-highlight, input zoom 방지)
- `prefers-reduced-motion` 접근성 준수
- 중앙화된 API 레이어 (832줄, 타입 완비, 15초 타임아웃)
- 스마트 LAN/Tailscale 감지로 개발 환경 자동 대응

**약점:**

| 문제 | 심각도 | 설명 |
|------|--------|------|
| App.tsx God Component | CRITICAL | ~70개 useState 훅, 모든 상태/핸들러가 한 컴포넌트 |
| styles.css 6,613줄 | HIGH | 모놀리식 CSS, 클래스 중복, !important 남용 |
| 라우팅 부재 | HIGH | URL 딥링크 불가, 브라우저 뒤로가기 미지원 |
| 상태 관리 부재 | HIGH | Context/zustand/jotai 없이 순수 props drilling |
| any 타입 다수 | MEDIUM | `App.tsx:61,86,95-97` 등에서 any 사용 |
| 미사용 state 4개 | MEDIUM | `setBrain`, `setNotifToast` 등 값만 없는 useState |
| OnboardingStyles 불일치 | MEDIUM | 유일하게 CSS-in-JS 방식 (나머지는 외부 CSS) |
| 유닛 테스트 0 | MEDIUM | Playwright E2E만 존재, 컴포넌트 테스트 없음 |
| 모달 포커스 트랩 없음 | MEDIUM | ArenaWatchModal, PostDetailModal에 포커스 관리 부재 |
| aria-live 미설정 | MEDIUM | 토스트, 채팅 메시지, 로딩 상태에 스크린리더 알림 없음 |

### 2.3 데이터베이스 — 8/10

**강점:**
- 잘 정규화된 스키마 (933줄 schema.sql + 17개 마이그레이션)
- UUID 기본키, JSONB 활용, append-only 이벤트 로그
- Transaction 지원 (BEGIN/COMMIT/ROLLBACK + finally release)
- 30+ 테이블로 완전한 도메인 모델링

**약점:**
- 테이블 과다 (거버넌스/비밀결사/연구소 등 frozen 기능의 테이블이 여전히 존재)
- 인덱스 최적화 검토 필요 (대규모 데이터 시)

---

## 3. 기능 완성도

| 기능 | 상태 | 비고 |
|------|------|------|
| 대화 + AI 응답 | ✅ 완료 | 폴링 기반, 지수 백오프 |
| 기억 인용 뱃지 | ✅ 완료 | 최근 메시지 기반 감지, 카드 그룹화 |
| 펫 통계/성격 | ✅ 완료 | hunger/energy/mood/bond/curiosity/stress |
| 온보딩 가챠 | ✅ 완료 | 4단계 (선택→생성→탄생→완료) |
| BYOK 연결 | ✅ 완료 | 5 프로바이더 + OAuth 6개 |
| 아레나 재판 | ✅ 완료 | COURT_TRIAL (IRAC, 3라운드, 실제 판례) |
| 아레나 디베이트 | ✅ 완료 | DEBATE_CLASH (실시간 스코어링) |
| 라이브 관전 | ✅ 완료 | 786줄 ArenaWatchModal (최고 품질 컴포넌트) |
| 코칭 내러티브 | ✅ 완료 | 전략 선택 → 결과 반영 |
| 플라자 피드 | ✅ 완료 | 게시글/댓글/좋아요, 검색 |
| ELO 레이팅 | ✅ 완료 | K-factor 24, 리더보드 |
| 프록시 폴백 | ✅ 완료 | BYOK 없는 유저도 체험 가능 |
| 알림 시스템 | ✅ 완료 | 10초 폴링, 벨 배지 |
| 데모 시나리오 | ✅ 완료 | 3막 10분 시나리오 문서화 |

**남은 작업 (P1):**
- P1-3: 법정 재판 프롬프트 튜닝 (백엔드)
- P1-4: AI 판결 비교 정제 (백엔드)
- P1-5: 관전 해설 검증 (백엔드)
- D1~D3: 데모 준비 (양 트랙)

---

## 4. 개선 제안 — 우선순위별

### 🔴 P0: 데모 전 필수 (D-7 이내)

없음 — 데모 관점에서 블로커는 모두 해결됨.

### 🟡 P1: 데모 직후 우선 (2/17~)

#### 1. App.tsx 분리 — God Component 해체
```
현재: App.tsx (616줄, ~70 useState)
목표: 도메인별 상태 분리

추천 구조:
├── stores/
│   ├── useAuthStore.ts      (auth, token, user)
│   ├── usePetStore.ts       (pet, stats, facts, progression)
│   ├── useArenaStore.ts     (matches, leaderboard, history)
│   ├── usePlazaStore.ts     (posts, comments)
│   └── useUIStore.ts        (tab, toast, modals)
```
- **도구**: `zustand` (1.1KB) 또는 `jotai` — 둘 다 가볍고 보일러플레이트 최소
- **효과**: 리렌더링 범위 축소, 기능별 독립 개발 가능, 테스트 용이

#### 2. 라우팅 도입
```
추천: wouter (1.5KB) — 가장 가벼운 React 라우터

/                → PetTab (기본)
/arena           → ArenaTab
/arena/:matchId  → ArenaWatchModal (딥링크!)
/plaza           → PlazaTab
/plaza/:postId   → PostDetailModal (딥링크!)
/settings        → SettingsPanel
```
- **효과**: URL 공유, 브라우저 뒤로가기, 코드 스플리팅 기반 마련

#### 3. 입력 검증 레이어 추가 (백엔드)
```
추천: zod (가볍고 TypeScript 친화적)

// routes/pets.js
const ActionSchema = z.object({
  action: z.enum(['feed', 'play', 'sleep', 'talk']),
  message: z.string().max(2000).optional()
});

router.post('/actions', userAuth, validate(ActionSchema), asyncHandler(...))
```
- **효과**: 일관된 검증, 자동 에러 메시지, 타입 추론

#### 4. CSS 모듈화
```
현재: styles.css (6,613줄 단일 파일)
목표: 컴포넌트별 CSS 모듈

├── styles/
│   ├── design-system.css    (변수, 리셋, 타이포그래피)
│   ├── layout.css           (그리드, 카드, 모달)
│   └── components/
│       ├── ChatUI.module.css
│       ├── ArenaWatch.module.css
│       ├── PetHeader.module.css
│       └── ...
```
- Vite는 CSS Modules 기본 지원 (`*.module.css`)
- 중복 클래스 `.arenaModeGrid` (line 1375 vs 2712) 같은 문제 자연 해결

### 🟢 P2: 품질 향상 (2월 말~)

#### 5. ArenaService 분리 (5,770줄 → 4~5개 서비스)
```
ArenaService.js (5,770줄) →
├── ArenaMatchService.js     (매칭, 스케줄링)
├── ArenaCourtService.js     (COURT_TRIAL 로직)
├── ArenaDebateService.js    (DEBATE_CLASH 로직)
├── ArenaEloService.js       (레이팅 계산)
└── ArenaSpectatorService.js (관전, 치어, 투표)
```

#### 6. 테스트 인프라 구축
```
백엔드:
- jest + supertest → 라우트 통합 테스트
- 테스트용 PostgreSQL (docker-compose.test.yml)
- 목표: 핵심 서비스 50%+ 커버리지

프론트엔드:
- vitest + @testing-library/react
- 목표: 핵심 컴포넌트 (ChatUI, ArenaWatchModal) 단위 테스트
```

#### 7. 접근성 강화
```
- 모달 포커스 트랩 (ArenaWatchModal, PostDetailModal)
- aria-live="polite" → 토스트, 채팅 메시지
- aria-live="assertive" → 에러 알림
- role="dialog" + aria-modal="true" → 모든 모달
- 키보드 네비게이션 (Tab order 관리)
```

#### 8. TypeScript 마이그레이션 (백엔드)
- 점진적 마이그레이션: `.js` → `.ts` (allowJs + checkJs 먼저)
- 핵심 서비스부터 시작 (PetStateService, BrainJobService)
- API 요청/응답 타입 프론트엔드와 공유 (`packages/shared-types/`)

### 🔵 P3: 장기 개선 (3월~)

#### 9. Rate Limiter Redis 전환
- 현재 인메모리 → 프로세스 재시작 시 초기화
- `ioredis` + 슬라이딩 윈도우 알고리즘
- 멀티 인스턴스 배포 대비

#### 10. 실시간 통신 (WebSocket/SSE)
- 현재: 채팅 폴링 (1.2~10초), 알림 폴링 (10초), 아레나 폴링
- 목표: Server-Sent Events로 전환 (단방향이므로 SSE가 적합)
- 효과: 즉각 반응, 서버 부하 감소

#### 11. Frozen 테이블 정리
- 거버넌스, 비밀결사, 연구소 등 미사용 테이블 → 별도 마이그레이션으로 제거
- 관련 서비스 코드도 archive 처리

#### 12. 빌드 최적화
- Vite 매뉴얼 청크 분리 (vendor, arena, plaza)
- 이미지 최적화 (SVG 스프라이트 시트)
- `React.lazy()` + `Suspense`로 탭별 코드 스플리팅

---

## 5. 보안 체크리스트

| 항목 | 상태 | 비고 |
|------|------|------|
| SQL 인젝션 | ✅ 안전 | 전수 파라미터화 |
| XSS | ✅ 안전 | React 기본 이스케이프 + Helmet |
| CSRF | ⚠️ 부분 | JWT 기반이라 쿠키 CSRF 없지만, CORS만으로 의존 |
| 인증 | ✅ 안전 | timing-safe compare, SHA-256, AES-256-GCM |
| 비밀 관리 | ✅ 안전 | .env + 프로덕션 필수 검증 |
| Rate Limiting | ⚠️ 부분 | 있지만 인메모리 한계 |
| 입력 검증 | ❌ 미흡 | 스키마 검증 라이브러리 없음 |
| 의존성 | ⚠️ 확인 필요 | `npm audit` 실행 권장 |
| HTTPS | ⚠️ 미확인 | 배포 시 TLS 설정 필요 |

---

## 6. 코드 품질 메트릭

| 지표 | 수치 | 평가 |
|------|------|------|
| 백엔드 서비스 LOC | 32,522 | 대규모 — 분리 필요 |
| 프론트엔드 CSS LOC | 6,613 | 과대 — 모듈화 필요 |
| 프론트엔드 TSX LOC | ~5,200 | 적정 |
| 최대 파일 크기 | ArenaService 5,770줄 | ❌ 500줄 이하 권장 |
| 최대 컴포넌트 크기 | ArenaWatchModal 786줄 | ⚠️ 300줄 이하 권장 |
| App.tsx useState 수 | ~70개 | ❌ 상태 관리 필요 |
| API 엔드포인트 수 | ~40개 | 적정 |
| DB 테이블 수 | 40+ (활성 ~25) | 정리 필요 |
| 테스트 커버리지 | 백엔드 ~1%, 프론트 E2E만 | ❌ 개선 필수 |
| TypeScript strict | 프론트 ✅ / 백엔드 ❌ | 백엔드 마이그레이션 권장 |

---

## 7. 총평

### 잘한 점
1. **제품 비전이 명확** — 3가지 핵심 가치가 코드 전체에 일관되게 반영됨
2. **백엔드 아키텍처 탄탄** — 에러 처리, 보안, DB 레이어 모두 프로덕션급
3. **3계층 메모리 시스템** — Facts/Daily/Weekly 설계가 AI 펫 컨셉에 최적
4. **ArenaWatchModal** — 프로젝트 최고의 UI 컴포넌트, 몰입감 있는 관전 경험
5. **BYOK + 프록시 폴백** — 유저 진입 장벽 최소화하면서도 자체 AI 활용 유도
6. **문서화 수준** — START_HERE, DEMO_SCENARIO, RUNBOOK 등 팀 협업에 최적
7. **D-7에 97% 완성** — 데모 목표 달성 거의 확실

### 아쉬운 점
1. **프론트엔드 아키텍처 부채** — App.tsx God Component가 확장성 제한
2. **테스트 커버리지 극히 낮음** — 32K LOC 백엔드에 321줄 테스트
3. **CSS 모놀리스** — 6,613줄 단일 파일, 유지보수 어려움
4. **입력 검증 부재** — 서비스 레이어에서 수동 처리, 일관성 없음

### 결론

**데모 준비도: 97% — 남은 작업은 프롬프트 튜닝뿐.**

백엔드는 프로덕션 수준에 근접한 품질이며, 프론트엔드는 시각적 완성도가 높지만 구조적 리팩터링이 필요합니다. 데모 이후 P1 개선(상태 관리, 라우팅, 입력 검증, CSS 모듈화)을 실행하면 프로덕션 런칭 기반이 마련됩니다.

**즉시 실행 순서 (데모 후):**
1. `zustand` 도입 → App.tsx 분해 (1~2일)
2. `wouter` 라우팅 추가 (0.5일)
3. `zod` 입력 검증 미들웨어 (1일)
4. CSS 모듈 분리 (1~2일)

---

*이 리뷰는 프로젝트의 모든 소스 코드, 문서, 설정 파일을 분석하여 작성되었습니다.*
